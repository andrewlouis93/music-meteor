<head>
  <title>music</title>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:600&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Knewave' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lato:700' rel='stylesheet' type='text/css'>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
  <script>
  $(function() {
    $( "#playlist" ).sortable({
	update: function(){
	Template.list.updateList(); //Updates on moving the position of an element around.
     }});
    $( "#playlist" ).disableSelection();
  });
  </script>
  <script>
	function onClientLoad() {
	    gapi.client.load('youtube', 'v3', onYouTubeApiLoad);
	}

	// Called automatically when YouTube API interface is loaded
	function onYouTubeApiLoad() {
	    gapi.client.setApiKey('AIzaSyD1VcsNnysOY6_Za-8kE-BK6Zh8jQwvo4w');
	}

      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
	$("#player").hide();
      }

function onPlayerReady(){
//console.log("ready");
}

function onPlayerStateChange(e){
//Save last signal so there is no upwards cascade in check_loop

console.log(e);
 if(e.data == YT.PlayerState.ENDED){
	console.log("ENDED SIGNAL");
	Template.unremovable_track.check_loop(player.getPlaylistIndex(),e.data);
}
else if (e.data == YT.PlayerState.PLAYING){
	console.log("PLAYING SIGNAL " + player.getPlaylistIndex());
	Session.set("last_signal",e.data);
}
else if (e.data == YT.PlayerState.PAUSED){
	console.log(player.getPlaylistIndex());
	console.log("PAUSED SIGNAL");
	Session.set("last_signal",e.data);
}
else if (e.data == YT.PlayerState.BUFFERING){
	console.log("BUFFERING SIGNAL");
	Session.set("last_signal",e.data);
}
else if (e.data == YT.PlayerState.CUED){
	console.log("CUED SIGNAL");
	Session.set("last_signal",e.data);
}
else if (e.data == -1){
	//alert("UNSTARTED SIGNAL " + player.getPlaylistIndex());
	Template.unremovable_track.check_loop(player.getPlaylistIndex(),e.data);
}

}

function generatePlaylist(list){
	player.loadPlaylist(list);
}
  </script>
</head>

<body>
  {{> header}}
  {{> search_bar}}
  {{> player}}
  {{> list}}
  {{> fucking_list}} 
  {{> generate}}
</body>

<template name="header">
  <h1 id="title">MIXTAPE</h1>
   <div class="absolute_center" id="generate_button">
	<i class="fa fa-play-circle-o" id="play"></i>
   </div>
   <div class="absolute_center2" id="close_player">
	<i class="fa fa-list" id="close"></i>
    </div>
</template>

<template name="search_bar">
  <input id="query" type="text" placeholder="Journey - Don't Stop Believin'" />
</template>

<template name="list">
<div id="playlist_container">
  <ul id="playlist">
    {{#each my_playlist}}
	{{#each songs}}
           {{> track}}
	{{/each}}
    {{/each}}	
  </ul>
</div>
</template>

<template name="generate">
	<div id="button_control">
		<div class="button is-inverse has-icon-spacing" id="share" data-toggle="modal" data-target="#myModal"><i class="fa fa-users"></i>Share</div>
<!--<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="share">
  <i class="fa fa-users"></i>Share
</button>
-->		
	</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="share" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="modal_title" class="modal-title">Share and Collaborate!</h3>
      </div>
      <div class="modal-body">
       	<input id="share_link" type="text" class="input-group form-control" /> 
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->	
</template>

<template name="player">
	<div id="player"></div>
</template>

<template name="fucking_list">
	<div id="navigation">
	    {{#each navlist}}
			  {{> unremovable_track}}	
	    {{/each}}
	</div>
</template>

<template name="track">

<!--<li id="{{_id}}" class="list_element">-->
<li id="{{index}}" class="list_element">
<!--<li id="{{index}}" class="list_element">-->
<!-- Have to make proper track <li> element.
    <div class="thumbnail" style="background-image:url('{{thumbnail}}')"></div>
-->
    <div class="destroy"> </div>
    <div class="element_style">{{song_title}}</div>
    <button class="next_song">next</button>

</li>

</template>

<template name="unremovable_track">
<li id="video-{{index}}" class="unremovable list_element">
<!-- Have to make proper track <li> element.
    <div class="thumbnail" style="background-image:url('{{thumbnail}}')"></div>
-->
    <div class="element_style">{{song_title}}</div>
    <button class="loop_activate">Loop Me</button>
</li>
</template>

